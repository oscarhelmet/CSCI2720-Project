<!-- I declare that the lab work here submitted is original
except for source material explicitly acknowledged,
and that the same or closely related material has not been
previously submitted for another course.
I also acknowledge that I am aware of University policy and
regulations on honesty in academic work, and of the disciplinary
guidelines and procedures applicable to breaches of such
policy and regulations, as contained in the website.
University Guideline on Academic Honesty:
https://www.cuhk.edu.hk/policy/academichonesty/
Student Name : Fan Chun Ho
Student ID : 1155160706
Class/Section : CSCI2720
Date :  
-->
<!DOCTYPE html>
<head>
    <title>Digital Data Management System (DDMS)</title>
</head>

<body>
    <header class="card-header m-5" style="background-color: blue;">
        <h1 style="color:aliceblue;">Welcome to DDMS, you can edit your data here.</h1>
    </header>

    <div style="display: inline;">
        <h1>Create New Event</h1>
        
        <form id="newEvent" action="http://localhost:3000/ev" method="post">
            
            <label for="eventname">Event name:</label><br>
            <input type="text" id="eventname" name="name">
            <br>

            <label for="eventloc">Location ID:</label><br>
            <input type="text" id="eventloc" name="loc">
            <br>

            <label for="eventquota">Event quota:</label><br>
            <input type="text" id="eventquota" name="quota"><br>
            <br>

            <input type="submit">
        </form>
    </div>
    <hr>
    <div style="display: inline;">
        
        <h1>Update Event</h1>
        <div>
            <label for="eventid">Load Event by ID: </label>
            <input id="eventid" name="eventid">
            <button onclick="handleLoad()">Load Event</button>
        </div>
        <br>
        <form id="updateEvent" onsubmit="handleSubmission()">

            <label for="name2">Event name: </label><br>
            <input type="text" id="name2" name="name">
            <br>

            <label for="loc2">Location ID: </label><br>
            <input type="text" id="loc2" name="loc">
            <br>

            <label for="quota2">Event quota: </label><br>
            <input type="text" id="quota2" name="quota"><br>
            <br>

            <input type="submit">
        </form>
    </div>
    <hr>
    <br>
    <footer style="background-color: blue;">
        <br>
    </footer>
</body>
<script>
    function handleLoad() {
        let id = document.getElementById('eventid').value;
        if (id!==null) {
            fetch('http://localhost:3000/ev/' + id)
            .then((res) => res.json())
            .then((event) => {
                document.getElementById('name2').value = event.name;
                document.getElementById('loc2').value = event.loc.locId;
                document.getElementById('quota2').value = event.quota;
            })
        }
    }
    function handleSubmission() {
        let url = 'http://localhost:3000/ev/' + document.getElementById('eventid').value;
        const output = {
                        "name": document.getElementById('name2').value,
                        "locId": document.getElementById('loc2').value,
                        "quota": document.getElementById('quota2').value
                       };
        fetch(url, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(output),
            mode: "cors"
        })
        .then(window.open(url));
    }
</script>
</html>